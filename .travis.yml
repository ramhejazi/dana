language: nodejs
sudo: required
dist: trusty
node_js:
  - '6'
  - '8'
  - 'stable'

addons:
  apt:
    sources:
      - mysql-5.7-trusty
    packages:
      - mysql-server
      - mysql-client

before_install:
  - sudo mysql -e "use mysql; update user set authentication_string=PASSWORD('secret_password') where User='root'; update user set plugin='mysql_native_password';FLUSH PRIVILEGES;"
  - sudo mysql_upgrade
  - sudo service mysql restart
  - mysql -uroot -psecret_password -e 'CREATE DATABASE IF NOT EXISTS test_db;'
  - mysql -uroot -psecret_password -e "GRANT ALL PRIVILEGES ON test_db.* TO 'db_user'@'localhost' IDENTIFIED BY 'secret_password'"

after_success: npm run coverage
